<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zhita.dao.manage.PaymentRecordMapper" >
  <resultMap id="BaseResultMap" type="com.zhita.model.manage.Payment_record" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="orderId" property="orderid" jdbcType="INTEGER" />
    <result column="remittanceTime" property="remittancetime" jdbcType="VARCHAR" />
    <result column="professionalWork" property="professionalwork" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="VARCHAR" />
    <result column="deleted" property="deleted" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Example_Where_Clause" >
    <where >
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause" >
    <where >
      <foreach collection="example.oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    id, orderId, remittanceTime, professionalWork, status, deleted
  </sql>



  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from payment_record
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from payment_record
    where id = #{id,jdbcType=INTEGER}
  </delete>
 
 
 
  <insert id="insert" parameterType="com.zhita.model.manage.Payment_record" >
    insert into payment_record (id, orderId, remittanceTime, 
      professionalWork, status, deleted
      )
    values (#{id,jdbcType=INTEGER}, #{orderid,jdbcType=INTEGER}, #{remittancetime,jdbcType=VARCHAR}, 
      #{professionalwork,jdbcType=VARCHAR}, #{status,jdbcType=VARCHAR}, #{deleted,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.zhita.model.manage.Payment_record" >
    insert into payment_record
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="orderid != null" >
        orderId,
      </if>
      <if test="remittancetime != null" >
        remittanceTime,
      </if>
      <if test="professionalwork != null" >
        professionalWork,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="deleted != null" >
        deleted,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="orderid != null" >
        #{orderid,jdbcType=INTEGER},
      </if>
      <if test="remittancetime != null" >
        #{remittancetime,jdbcType=VARCHAR},
      </if>
      <if test="professionalwork != null" >
        #{professionalwork,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="deleted != null" >
        #{deleted,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>


 
 
 
 
  <update id="updateByPrimaryKeySelective" parameterType="com.zhita.model.manage.Payment_record" >
    update payment_record
    <set >
      <if test="orderid != null" >
        orderId = #{orderid,jdbcType=INTEGER},
      </if>
      <if test="remittancetime != null" >
        remittanceTime = #{remittancetime,jdbcType=VARCHAR},
      </if>
      <if test="professionalwork != null" >
        professionalWork = #{professionalwork,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=VARCHAR},
      </if>
      <if test="deleted != null" >
        deleted = #{deleted,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.zhita.model.manage.Payment_record" >
    update payment_record
    set orderId = #{orderid,jdbcType=INTEGER},
      remittanceTime = #{remittancetime,jdbcType=VARCHAR},
      professionalWork = #{professionalwork,jdbcType=VARCHAR},
      status = #{status,jdbcType=VARCHAR},
      deleted = #{deleted,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>
  
  
  
  
  
		  <select id="TotalCountPayment" parameterType="com.zhita.model.manage.Payment_record" resultType="java.lang.Integer">
		  	select count(ra.id) from payment_record ra,user u,orders o,orderdetails ord,thirdparty_interface thir
		  	<where>
		  		AND ra.thirdparty_id = thir.id
		  		AND ra.orderId = o.id
		  		AND o.userId = u.id
		  		AND o.id = ord.orderId
		  		AND o.companyId = #{companyId}
		  		<if test="orderId != null and orderId != ''">
		  			AND ra.orderId = #{orderId}
		  		</if>
		  		<if test="pipelinenumber != null and pipelinenumber != ''">
		  			AND ra.pipelinenumber = #{pipelinenumber}
		  		</if>
		  		<if test="name != null and name != ''">
		  			AND u.name LIKE concat('%',#{name},'%') 
		  		</if>
		  		<if test="phone != null and phone != ''">
		  			AND u.phone LIKE concat('%',#{phone},'%')  
		  		</if>
		  		<if test="thirdparty_id != null and thirdparty_id != ''">
					AND thir.id = #{thirdparty_id}
				</if>
		  		<if test="start_time != null and start_time != '' and end_time != null and end_time != ''">
					AND ra.remittanceTime between #{start_time} and #{end_time}
				</if>
		  	</where>
		  </select>
		  
  
  
  
  
  
  		  <select id="PaymentAll" parameterType="com.zhita.model.manage.Payment_record" resultType="com.zhita.model.manage.Payment_record">
		  	select ra.remittanceTime,thir.loanSource,o.orderNumber,u.name,u.phone,ra.paymentmoney
		  	 from payment_record ra LEFT JOIN orders o ON ra.orderId = o.id
		  	 LEFT JOIN user u ON o.userId = u.id
		  	 LEFT JOIN orderdetails ord ON o.id = ord.orderId
		  	 LEFT JOIN thirdparty_interface thir ON ra.thirdparty_id = thir.id
		  	<where>
		  		AND ra.professionalWork = #{professionalWork}
		  		AND o.companyId = #{companyId}
		  		<if test="orderNumber != null and orderNumber != ''">
		  			AND o.orderNumber LIKE concat('%',#{orderNumber},'%') 
		  		</if>
		  		<if test="pipelinenumber != null and pipelinenumber != ''">
		  			AND ra.pipelinenumber = #{pipelinenumber}
		  		</if>
		  		<if test="name != null and name != ''">
		  			AND u.name LIKE concat('%',#{name},'%') 
		  		</if>
		  		<if test="phone != null and phone != ''">
		  			AND u.phone LIKE concat('%',#{phone},'%')  
		  		</if>
		  		<if test="thirdparty_id != null and thirdparty_id != ''">
					AND thir.id = #{thirdparty_id}
				</if>
		  		<if test="start_time != null and start_time != '' and end_time != null and end_time != ''">
					AND ra.remittanceTime between #{start_time} and #{end_time}
				</if>
		  	</where>
		  	order by ra.id desc
		  	limit #{page},#{pagesize}
		  </select>
  
  
  
  
  			<select id="ThirdAll" parameterType="java.lang.Integer" resultType="com.zhita.model.manage.Thirdparty_interface">
  				select id,loanSource,repaymentSource from Thirdparty_interface where companyId = #{companyId}
  			</select>
  
  
  
  			<select id="RepaymentTotalCount" parameterType="com.zhita.model.manage.Payment_record" resultType="java.lang.Integer">
			  	select count(ra.id) from repayment ra,user u,orders o,thirdparty_interface thir
			  	<where>
			  		AND ra.orderId = o.id
			  		AND ra.thirdparty_id = thir.id
			  		AND o.userId = u.id
			  		AND o.companyId = #{companyId}
			  		<if test="orderId != null and orderId != ''">
			  			AND ra.orderId = #{orderId}
			  		</if>
			  		<if test="pipelinenumber != null and pipelinenumber != ''">
			  			AND ra.pipelinenumber = #{pipelinenumber}
			  		</if>
			  		<if test="name != null and name != ''">
			  			AND u.name LIKE concat('%',#{name},'%') 
			  		</if>
			  		<if test="phone != null and phone != ''">
			  			AND u.phone LIKE concat('%',#{phone},'%')  
			  		</if>
			  		<if test="thirdparty_id != null and thirdparty_id != ''">
						AND thir.id = #{thirdparty_id}
					</if>
			  		<if test="start_time != null and start_time != '' and end_time != null and end_time != ''">
						AND ra.repaymentDate between #{start_time} and #{end_time}
					</if>
			  	</where>
			  </select>
		  
  			
  			
  			<select id="RepaymentAll" parameterType="com.zhita.model.manage.Payment_record" resultType="com.zhita.model.manage.Payment_record">
			  	select o.id,ra.repaymentDate,thir.loanSource,ra.pipelinenumber,ra.repaymentMoney,o.orderNumber,u.name,u.phone
			  	 from repayment ra LEFT JOIN orders on ra.orderId = o.id
			  	 LEFT JOIN user u ON o.userId = u.id
			  	 LEFT JOIN orderdetails ord ON o.id = ord.orderId
			  	 LEFT JOIN thirdparty_interface thir ON ra.thirdparty_id = thir.id
			  	<where>
			  		AND o.companyId = #{companyId}
			  		<if test="orderId != null and orderId != ''">
			  			AND ra.orderId = #{orderId}
			  		</if>
			  		<if test="pipelinenumber != null and pipelinenumber != ''">
			  			AND ra.pipelinenumber = #{pipelinenumber}
			  		</if>
			  		<if test="name != null and name != ''">
			  			AND u.name LIKE concat('%',#{name},'%') 
			  		</if>
			  		<if test="phone != null and phone != ''">
			  			AND u.phone LIKE concat('%',#{phone},'%')
			  		</if>
			  		<if test="start_time != null and start_time != '' and end_time != null and end_time != ''">
						AND ra.repaymentDate between #{start_time} and #{end_time}
					</if>
					<if test="thirdparty_id != null and thirdparty_id != ''">
						AND thir.id = #{thirdparty_id}
					</if>
			  	</where>
			  	order by ra.id desc
		  		limit #{page},#{pagesize}
			  </select>
		  
  			
  			
  			<select id="SelectThird" parameterType="java.lang.Integer" resultType="com.zhita.model.manage.Loan_setting">
  				select id,name from loan_setting where companyId = #{companyId}
  			</select>
  			
  			
  			
  			<select id="SelectRepay" parameterType="java.lang.Integer" resultType="com.zhita.model.manage.Repayment_setting">
  				select id,name from repayment_setting where companyId = #{companyId}
  			</select>
  			
  			
  			
  			 <select id="SelectPaymentOrder" parameterType="com.zhita.model.manage.Orderdetails" resultType="com.zhita.model.manage.Orderdetails">
  			 		select ord.orderId,o.orderNumber,u.name,u.phone,u.registeTime,o.orderCreateTime,d.drainageOfPlatformName,o.riskmanagementFraction,
  			 		o.borrowMoneyWay,o.shouldReturnTime,ord.realityBorrowMoney,ord.makeLoans,ord.interestInAll,ord.realityAccount,o.riskcontrolname,
  			 		ord.overdueNumberOfDays,defeset.onceDeferredDay,defe.interestOnArrears,defe.deferBeforeReturntime,defe.deferAfterReturntime,ord.InterestSum,
  			 		ord.interestPenaltySum,o.realtime 
  			 		from drainage_of_platform d left join user u on d.id = u.drainageOfPlatformId
  			 		left join orders o on o.userId = u.id
  			 		left join orderdetails ord on o.id = ord.orderId
  			 		left join deferred defe on defe.orderid = o.id
  			 		left join deferred_settings defeset on defeset.companyId = o.companyId
  			 		<where>
  			 			AND o.orderNumber LIKE concat('%',#{orderNumber},'%')  
  			 			AND d.companyId = #{companyId}
  			 		</where>
  			 </select>
  
  
  
  
  			<select id="OrdeRepayment" parameterType="com.zhita.model.manage.Orderdetails" resultType="com.zhita.model.manage.Orderdetails">
  					select ord.orderId,o.orderNumber,u.name,u.phone,u.registeTime,o.orderCreateTime,d.drainageOfPlatformName,o.riskmanagementFraction,
  			 		o.borrowMoneyWay,o.shouldReturnTime,ord.realityBorrowMoney,ord.makeLoans,ord.interestInAll,ord.realityAccount,o.riskcontrolname,o.borrowTimeLimit,
  			 		ord.overdueNumberOfDays,defeset.onceDeferredDay,defe.interestOnArrears,defe.deferBeforeReturntime,defe.deferAfterReturntime,ord.InterestSum,pay.pipelinenumber,
  			 		ord.interestPenaltySum,o.realtime 
  			 		from drainage_of_platform d left join user u on d.id = u.drainageOfPlatformId
  			 		left join orders o on o.userId = u.id
  			 		left join orderdetails ord on o.id = ord.orderId
  			 		left join deferred defe on defe.orderid = o.id
  			 		left join deferred_settings defeset on defeset.companyId = o.companyId
  			 		left join payment_record pay on pay.orderId = o.id
  					<where>
  			 			AND o.orderNumber LIKE concat('%',#{orderNumber},'%') 
  			 			AND d.companyId = #{companyId}
  					</where>
  					group by ord.orderId
  			</select>
  			
  			
  			
  			<insert id="AddCAccount" parameterType="com.zhita.model.manage.Accountadjustment">
  				 INSERT INTO `accountadjustment`(
  				 		orderId,
  				 		totalamount,
  				 		amountmoney,
  				 		remarks,
  				 		accounttime,
  				 		beoverdue,
  				 		repaymentSource,
  				 		amou_time,
  				 		sys_uerId
  				 )
  				 VALUES
  				 (#{orderId},#{totalamount},#{amountmoney},#{remarks},#{accounttime},#{beoverdue},#{repaymentSource},#{amou_time},#{sys_uerId})
  			</insert>
  			
  			
  			
  			
  			
  			<select id="AccountTotalCount" parameterType="com.zhita.model.manage.Orderdetails" resultType="java.lang.Integer">
  				select count(a.id) from orders o,user u,accountadjustment a,repayment re
  				<where>
  					AND o.id = a.orderId
  					AND re.orderId = o.id
  					AND o.companyId = #{companyId}
  					AND o.userId = u.id
  					AND o.orderStatus = "2"
  					<if test="start_time != null and start_time != '' and end_time != null and end_time != ''">
						AND o.orderCreateTime between #{start_time} and #{end_time}
					</if>
					<if test="accounttimestart_time != null and accounttimestart_time != '' and accounttimeent_time != null and accounttimeent_time != ''">
						AND a.accounttime between #{accounttimestart_time} and #{accounttimeent_time}
					</if>
					<if test="name != null and name != ''">
						AND u.name LIKE concat('%',#{name},'%') 
					</if>
					<if test="phone != null and phone != ''">
						AND u.phone LIKE concat('%',#{phone},'%') 
					</if>
					<if test="orderNumber != null and orderNumber != ''">
						AND o.orderNumber LIKE concat('%',#{orderNumber},'%')
					</if>
					<if test="repaymentSource != null and repaymentSource != ''">
						AND th.repaymentSource = #{repaymentSource}
					</if>
  				</where>
  			</select>
  			
  			
  			
  			
  			
  			
  			<select id="AllAccount" parameterType="com.zhita.model.manage.Orderdetails" resultType="com.zhita.model.manage.Accountadjustment">
  				select o.orderNumber,u.name,u.phone,th.repaymentSource,a.accounttime,a.totalamount,a.amountmoney,a.remarks,a.beoverdue,a.amou_time
  				 from orders o left join user u on o.userId = u.id
  				 left join accountadjustment a on o.id = a.orderId
  				 left join repayment re on re.orderId = o.id
  				 left join thirdparty_interface th on th.id = re.thirdparty_id
  				<where>
  					AND o.companyId = #{companyId}
  					AND a.accounttime &gt; #{realtime}
  					<if test="start_time != null and start_time != '' and end_time != null and end_time != ''">
						AND o.orderCreateTime between #{start_time} and #{end_time}
					</if>
					<if test="name != null and name != ''">
						AND u.name LIKE concat('%',#{name},'%') 
					</if>
					<if test="phone != null and phone != ''">
						AND u.phone LIKE concat('%',#{phone},'%')  
					</if>
					<if test="orderNumber != null and orderNumber != ''">
						AND o.orderNumber LIKE concat('%',#{orderNumber},'%') 
					</if>
					<if test="thirdparty_id != null and thirdparty_id != ''">
						AND re.thirdparty_id = #{thirdparty_id}
					</if>
					<if test="accounttimestart_time != null and accounttimestart_time != '' and accounttimeent_time != null and accounttimeent_time != ''">
						AND a.accounttime between #{accounttimestart_time} and #{accounttimeent_time}
					</if>
  				</where>
  				order by o.id desc
  				limit #{page},#{pagesize}
  			</select>
  
  
  
  			
  			
  			<select id="AllStatu" parameterType="com.zhita.model.manage.Orderdetails" resultType="com.zhita.model.manage.Accountadjustment">
  				select o.id,o.orderNumber,u.name,u.phone,th.repaymentSource,a.accounttime,a.totalamount,a.amountmoney,a.remarks,a.accounttime,a.beoverdue,
  				 a.amou_time from orders o LEFT JOIN user u ON o.userId = u.id
  				 LEFT JOIN accountadjustment a ON o.id = a.orderId
  				 LEFT JOIN repayment re ON re.orderId = o.id
  				 LEFT JOIN thirdparty_interface th ON th.id = re.thirdparty_id
  				<where>
  					AND o.companyId = #{companyId}
  					AND o.orderStatus = "3"
  					<if test="start_time != null and start_time != '' and end_time != null and end_time != ''">
						AND o.orderCreateTime between #{start_time} and #{end_time}
					</if>
					<if test="name != null and name != ''">
						AND u.name LIKE concat('%',#{name},'%')  
					</if>
					<if test="phone != null and phone != ''">
						AND u.phone LIKE concat('%',#{phone},'%') 
					</if>
					<if test="orderNumber != null and orderNumber != ''">
						AND o.orderNumber LIKE concat('%',#{orderNumber},'%')  
					</if>
					<if test="repaymentSource != null and repaymentSource != ''">
						AND th.repaymentSource = #{repaymentSource}
					</if>
					<if test="accounttimestart_time != null and accounttimestart_time != '' and accounttimeent_time != null and accounttimeent_time != ''">
						AND a.accounttime between #{accounttimestart_time} and #{accounttimeent_time}
					</if>
  				</where>
  				group by o.id desc
  				limit #{page},#{pagesize}
  			</select>
  			
  			
  			
  			
  			<select id="AllNotMoneyStatu" parameterType="com.zhita.model.manage.Orderdetails" resultType="com.zhita.model.manage.Accountadjustment">
  				select o.id,o.orderNumber,u.name,u.phone,th.repaymentSource,a.accounttime,a.totalamount,a.amou_time,
  				a.amountmoney,a.remarks,a.accounttime,a.beoverdue
  				,ord.overdueNumberOfDays from 
  				 orderdetails ord LEFT JOIN orders o ON o.id = ord.orderId
  				 LEFT JOIN user u ON o.userId = u.id
  				 LEFT JOIN accountadjustment a ON o.id = a.orderId
  				 LEFT JOIN repayment re ON re.orderId = o.id
  				 LEFT JOIN thirdparty_interface th ON th.id = re.thirdparty_id
  				<where>
  					AND a.accounttime &lt; #{realtime}
  					AND o.companyId = #{companyId}
  					<if test="start_time != null and start_time != '' and end_time != null and end_time != ''">
						AND o.orderCreateTime between #{start_time} and #{end_time}
					</if>
					<if test="name != null and name != ''">
						AND u.name LIKE concat('%',#{name},'%') 
					</if>
					<if test="phone != null and phone != ''">
						AND u.phone LIKE concat('%',#{phone},'%')  
					</if>
					<if test="orderNumber != null and orderNumber != ''">
						AND o.orderNumber LIKE concat('%',#{orderNumber},'%') 
					</if>
					<if test="repaymentSource != null and repaymentSource != ''">
						AND th.repaymentSource = #{repaymentSource}
					</if>
					<if test="accounttimestart_time != null and accounttimestart_time != '' and accounttimeent_time != null and accounttimeent_time != ''">
						AND a.accounttime between #{accounttimestart_time} and #{accounttimeent_time}
					</if>
  				</where>
  				group by o.id desc
  				limit #{page},#{pagesize}
  			</select>
  			
  			
  			
  			
  			
  			
  			
  			<insert id="AddUndertheline" parameterType="com.zhita.model.manage.Undertheline">
	  			 INSERT INTO `Undertheline`(
	  				 		underthe_time,
	  				 		orderId,
	  				 		finance_id,
	  				 		project_name,
	  				 		repayment,
	  				 		income,
	  				 		expenditure,
	  				 		repaymentnumber,
	  				 		remarks
	  				 )
	  				 VALUES
	  				 (#{underthe_time},#{orderId},#{finance_id},#{project_name},#{repayment},#{income},#{expenditure},#{repaymentnumber},#{remarks})
  			</insert>
  			
  			
  			
  			
  			<select id="SelectUnderthTotalCount" parameterType="com.zhita.model.manage.Orderdetails" resultType="java.lang.Integer">
  				select count(id) from Undertheline 
  				<where>
  					<if test="repaymentnumber != null and repaymentnumber != ''">
  						AND repaymentnumber = #{repaymentnumber}
  					</if>
  					<if test="start_time != null and start_time != '' and end_time != null and end_time != ''">
						AND underthe_time between #{start_time} and #{end_time}
					</if>
  				</where> 
  			</select>
  			
  			
  			
  			<select id="AllUnderthe" parameterType="com.zhita.model.manage.Orderdetails" resultType="com.zhita.model.manage.Undertheline">
  				select u.underthe_time,sy.account,u.project_name,u.repayment,u.income,u.expenditure,u.repaymentnumber,u.remarks
  				 from Undertheline u left join sys_user sy on u.finance_id = sy.userId
  				 left join orders o on o.id = u.orderId
  				<where>
  					AND o.companyId = #{companyId}
  					<if test="repaymentnumber != null and repaymentnumber != ''">
  						AND u.repaymentnumber = #{repaymentnumber}
  					</if>
  					<if test="start_time != null and start_time != '' and end_time != null and end_time != ''">
						AND u.underthe_time between #{start_time} and #{end_time}
					</if>
  				</where> 
  				group by o.id
  				limit #{page},#{pagesize}
  			</select>
  			
  			
  			
  			<select id="XiaOrder" parameterType="com.zhita.model.manage.Orderdetails" resultType="com.zhita.model.manage.Undertheline">
  					select u.underthe_time,sy.account,o.orderNumber,u.finance_id,ua.name,ua.phone,ord.makeLoans,u.income,u.remarks
  				 from Undertheline u LEFT JOIN sys_user sy ON u.finance_id = sy.userId
  				 LEFT JOIN orders o ON o.companyId = sy.companyId
  				 LEFT JOIN user ua ON o.id = u.orderId
  				 LEFT JOIN orderdetails ord ON o.id = ord.orderId
  				<where>
  					AND o.companyId = #{companyId}
  					<if test="orderNumber != null and orderNumber != ''">
  						AND o.orderNumber LIKE concat('%',#{orderNumber},'%')
  					</if>
  					<if test="phone != null and phone != ''">
  						AND ua.phone LIKE concat('%',#{phone},'%') 
  					</if>
  					<if test="name != null and name != ''">
  						AND ua.name LIKE concat('%',#{name},'%') 
  					</if>
  					<if test="start_time != null and start_time != '' and end_time != null and end_time != ''">
						AND u.underthe_time between #{start_time} and #{end_time}
					</if>
  				</where> 
  				GROUP BY u.finance_id
  				limit #{page},#{pagesize}
  			</select>
  			
  			
  			
  			
  			<select id="XiaTotalCount" parameterType="com.zhita.model.manage.Orderdetails" resultType="java.lang.Integer">
  				select count(u.id)
  				 from Undertheline u left join sys_user sy on u.finance_id=sy.userId
  				 left join orders o on u.orderId = o.id
  				 left join user ua on ua.id = o.userId
  				 left join orderdetails ord on o.id = ord.orderId 
  				<where>
  					AND o.companyId = #{companyId}
  					AND u.finance_id = sy.userId
  					AND o.id = u.orderId
					AND o.id = ord.orderId
					AND o.companyId = sy.companyId
  					<if test="orderNumber != null and orderNumber != ''">
  						AND o.orderNumber LIKE concat('%',#{orderNumber},'%') 
  					</if>
  					<if test="phone != null and phone != ''">
  						AND ua.phone LIKE concat('%',#{phone},'%')  
  					</if>
  					<if test="name != null and name != ''">
  						AND ua.name LIKE concat('%',#{name},'%') 
  					</if>
  					<if test="start_time != null and start_time != '' and end_time != null and end_time != ''">
						AND u.underthe_time between #{start_time} and #{end_time}
					</if>
  				</where> 
  				GROUP BY u.finance_id
  			</select>
  			
  			
  			
  			
  			
  			<select id="Sys_userIds" parameterType="java.lang.Integer" resultType="java.lang.Integer">
  				select userId from sys_user where companyId = #{companyId}
  			</select>
  			
  			
  			
  			
  			<select id="BankDeduOrderNum" parameterType="com.zhita.model.manage.Bankdeduction" resultType="java.lang.Integer">
  				select count(o.id) from bankdeduction b,orders o,user u,deferred defe
  				<where>
  					AND defe.orderId = o.id
  					AND o.id = b.orderId
  					AND defe.orderId = o.id
  					AND o.companyId = #{companyId}
  					<if test="orderNumber != null and orderNumber != ''">
  						AND o.orderNumber LIKE concat('%',#{orderNumber},'%') 
  					</if>
  					<if test="name != null and name != ''">
  						AND u.name LIKE concat('%',#{name},'%')  
  					</if>
  					<if test="phone != null and phone != ''">
  						AND u.phone LIKE concat('%',#{phone},'%') 
  					</if>
  					<if test="bankcardName != null and bankcardName != ''">
  						AND b.bankcardName = #{bankcardName}
  					</if>
  					<if test="startu_time != null and startu_time != '' and end_time != null and end_time != ''">
  						AND defe.deferAfterReturntime between #{startu_time} and #{end_time}
  					</if>
  					<if test="statu_timeOrder != null and statu_timeOrder != '' and end_timeOrder != null and end_timeOrder != ''">
  						AND o.orderCreateTime between #{startu_time} and #{end_time}
  					</if>
  					<if test="overdueGrade != null and overdueGrade != ''">
  						AND o.overdueGrade = #{overdueGrade}
  					</if>
  				</where>
  			</select>
  			
  			
  			
  			
  			
  			<select id="BankDeduOrder" parameterType="com.zhita.model.manage.Bankdeduction" resultType="com.zhita.model.manage.Orderdetails">
  				select ord.orderId,o.orderNumber,u.name,u.phone,o.borrowMoneyWay,o.borrowTimeLimit,o.shouldReturnTime,ord.overdueNumberOfDays,ord.interestPenaltySum,
				o.orderCreateTime,ord.realityBorrowMoney,ord.makeLoans,ord.realityAccount,colme.reallyName,o.overdueGrade,ord.surplus_money,col.collectionTime,
				col.promise_money,col.promise_money,
				col.collectionTime,col.collectionStatus,o.orderStatus,defe.deferBeforeReturntime,defe.deferAfterReturntime  
				 from orders o LEFT JOIN orderdetails ord ON o.id = ord.orderId
				 LEFT JOIN collection col ON o.id = col.orderId
				 LEFT JOIN collection_member colme ON	colme.collectionMemberId = col.collectionMemberId
				 LEFT JOIN user u ON o.userId = u.id
				 LEFT JOIN bankdeduction banl on banl.orderId = o.orderId
				 LEFT JOIN deferred defe on defe.orderId = o.id
  				<where>
  					AND o.companyId = #{companyId}
  					<if test="orderNumber != null and orderNumber != ''">
  						AND o.orderNumber LIKE concat('%',#{orderNumber},'%')  
  					</if>
  					<if test="name != null and name != ''">
  						AND u.name  LIKE concat('%',#{name},'%') 
  					</if>
  					<if test="phone != null and phone != ''">
  						AND u.phone  LIKE concat('%',#{phone},'%')
  					</if>
  					<if test="bankcardName != null and bankcardName != ''">
  						AND b.bankcardName = #{bankcardName}
  					</if>
  					<if test="startu_time != null and startu_time != '' and end_time != null and end_time != ''">
  						AND defe.deferAfterReturntime between #{startu_time} and #{end_time}
  					</if>
  					<if test="statu_timeOrder != null and statu_timeOrder != '' and end_timeOrder != null and end_timeOrder != ''">
  						AND o.orderCreateTime between #{startu_time} and #{end_time}
  					</if>
  					<if test="overdueGrade != null and overdueGrade != ''">
  						AND o.overdueGrade = #{overdueGrade}
  					</if>
  				</where>
  				group by banl.orderId
  				limit #{page},#{pagesize}
  			</select>
  			
  			
  			
  			
  			<select id="BanAll" parameterType="java.lang.Integer" resultType="com.zhita.model.manage.Bankdeduction">
  				select * from bankdeduction where orderId = #{orderId}
  			</select>
  			
  			
  			
  			
  			
  			<select id="DelayTatolCount" parameterType="com.zhita.model.manage.Bankdeduction" resultType="com.zhita.model.manage.Bankdeduction">
  				select count(id) from deferred 
  				<where>
  					<if test="startu_time != null and startu_time != '' and end_time != null and end_time != ''">
  						AND deferAfterReturntime between #{startu_time} and #{end_time}
  					</if>
  				</where>
  			</select>
  			
  			
  			
  			
  			<select id="DelayStatisc" parameterType="com.zhita.model.manage.Bankdeduction" resultType="com.zhita.model.manage.Bankdeduction">
  				select d.deferAfterReturntime,count(d.orderid) as orderNum,
  				sum(d.interestOnArrears) as interestOnArrearsSum from deferred d left join orders o on o.id = d.orderid
  				<where>
  					AND o.companyId = #{companyId}
  					<if test="startu_time != null and startu_time != '' and end_time != null and end_time != ''">
  						AND d.deferAfterReturntime between #{startu_time} and #{end_time}
  					</if>
  				</where>
  				group by d.deferAfterReturntime
  				limit #{page},#{pagesize}
  			</select>
  			
  			
  			
  			
  			<select id="OneBank" parameterType="com.zhita.model.manage.Bankdeduction" resultType="com.zhita.model.manage.Bankdeduction">
  				select count(o.id) as realborrowing,sum(ord.realityBorrowMoney) as realexpenditure,count(o.id) as realreturn,sum(ord.makeLoans) as paymentamount,
  				sum(ord.interestPenaltySum) as overdueamount from orders o,orderdetails ord 
  				 <where>
  				 AND o.id = ord.orderId
  				 AND o.companyId = #{companyId}
  				 <if test="startu_time != null and startu_time != '' and end_time != null and end_time != ''">
  				 	AND o.realtime between #{startu_time} and #{end_time}
  				 </if>
  				 </where>
  			</select>
  			
  			
  			
  			<select id="YanMoney" parameterType="com.zhita.model.manage.Bankdeduction" resultType="java.math.BigDecimal">
  				select sum(d.interestOnArrears) as deferredamount from deferred d,orders o 
  				<where>
  					AND o.id = d.orderid
  					AND o.companyId = #{companyId}
  					 <if test="startu_time != null and startu_time != '' and end_time != null and end_time != ''">
  					 	AND o.realtime between #{startu_time} and #{end_time}
  					 </if>
  				</where>
  			</select>
  			
  			
  			<insert id="AddOffJianMian" parameterType="com.zhita.model.manage.Offlinjianmian">
  				INSERT INTO `offlinjianmian`(
  					orderId,
  					fina_id,
  					offusermoney,
  					remarks
  				)VALUES(#{orderId},#{fina_id},#{offusermoney},#{remarks})
  			</insert>
  			
  			
  			<update id="UpdateOrderType" parameterType="java.lang.Integer">
  				update orders set orderStatus = "3" where orderId = #{orderId}
  			</update>
</mapper>